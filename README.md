# –°–∏—Å—Ç–µ–º–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –≥–∏–±–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **JWT —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤** –¥–æ—Å—Ç—É–ø–∞
- **CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
- **–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Python —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **JWT** - JSON Web Tokens –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **bcrypt** - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **Pytest** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
auth_system/
‚îú‚îÄ‚îÄ database/
‚îÇ ‚îî‚îÄ‚îÄ db.py # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models/
‚îÇ ‚îú‚îÄ‚îÄ user.py # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ ‚îú‚îÄ‚îÄ role.py # –ú–æ–¥–µ–ª—å —Ä–æ–ª–µ–π
‚îÇ ‚îú‚îÄ‚îÄ product.py # –ú–æ–¥–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–∞
‚îÇ ‚îî‚îÄ‚îÄ access_roles_rules.py # –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ routes/
‚îÇ ‚îú‚îÄ‚îÄ auth.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ ‚îú‚îÄ‚îÄ user_router.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ ‚îî‚îÄ‚îÄ resource_router.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤
‚îú‚îÄ‚îÄ middlewares/
‚îÇ ‚îú‚îÄ‚îÄ auth_middleware.py # Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ ‚îî‚îÄ‚îÄ authorization.py # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ utils/
‚îÇ ‚îî‚îÄ‚îÄ security.py # –£—Ç–∏–ª–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ tests/
‚îÇ ‚îî‚îÄ‚îÄ test_simple.py # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ services/
‚îÇ ‚îú‚îÄ‚îÄ init_roles.py # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ–ª–µ–π
‚îÇ ‚îî‚îÄ‚îÄ user_service.py # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ main.py # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ init_db.py # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îî‚îÄ‚îÄ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üóÑÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª—å –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```
Users (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ first_name
‚îú‚îÄ‚îÄ last_name
‚îú‚îÄ‚îÄ email
‚îú‚îÄ‚îÄ hashed_password
‚îú‚îÄ‚îÄ role_id (FK ‚Üí Roles.id)
‚îî‚îÄ‚îÄ is_active

Roles (–†–æ–ª–∏)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ name (admin, user)
‚îî‚îÄ‚îÄ description

AccessRolesRules (–ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ role_id (FK ‚Üí Roles.id)
‚îú‚îÄ‚îÄ element (users, products)
‚îú‚îÄ‚îÄ read_permission
‚îú‚îÄ‚îÄ read_all_permission
‚îú‚îÄ‚îÄ create_permission
‚îú‚îÄ‚îÄ update_permission
‚îú‚îÄ‚îÄ update_all_permission
‚îú‚îÄ‚îÄ delete_permission
‚îî‚îÄ‚îÄ delete_all_permission

Products (–ü—Ä–æ–¥—É–∫—Ç—ã)
‚îú‚îÄ‚îÄ id
‚îú‚îÄ‚îÄ name
‚îú‚îÄ‚îÄ description
‚îî‚îÄ‚îÄ owner_id (FK ‚Üí Users.id)
```

### –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤

- **admin** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
- **user** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `AccessRolesRules`

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
git clone <repository-url>
cd auth_system
python -m venv auth_system_env

# –î–ª—è Windows:
auth_system_env\Scripts\activate
# –î–ª—è Linux/Mac:
source auth_system_env/bin/activate

pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∏ –æ–±–Ω–æ–≤–∏—Ç–µ DATABASE_URL –≤ database/db.py:

```
DATABASE_URL = "postgresql://username:password@localhost/db_name"
```
### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
```
python init_db.py
```

–°–æ–∑–¥–∞–µ—Ç—Å—è:

- **–†–æ–ª–∏:** admin –∏ user

- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:** admin@example.com / admin123

- –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```
python main.py
```

#### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://127.0.0.1:8000

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API: http://127.0.0.1:8000/docs

## üîë API Endpoints


### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```
–ú–µ—Ç–æ–¥	Endpoint	–û–ø–∏—Å–∞–Ω–∏–µ
POST	/auth/register	–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST	/auth/login	–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```
–ú–µ—Ç–æ–¥	Endpoint	–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
GET	/users/me	–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
PATCH	/users/me	–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
DELETE	/users/me	–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
GET	/users/all	–¢–æ–ª—å–∫–æ admin
POST	/users/logout	–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```

### –†–µ—Å—É—Ä—Å—ã (–ü—Ä–æ–¥—É–∫—Ç—ã)
```
–ú–µ—Ç–æ–¥	Endpoint	–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
GET	/resource/products	–ß—Ç–µ–Ω–∏–µ —Å–≤–æ–∏—Ö/–≤—Å–µ—Ö
POST	/resource/products	–°–æ–∑–¥–∞–Ω–∏–µ
PUT	/resource/products/{id}	–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö/–≤—Å–µ—Ö
DELETE	/resource/products/{id}	–£–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö/–≤—Å–µ—Ö
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
curl -X POST "http://127.0.0.1:8000/auth/register" \
     -H "Content-Type: application/json" \
     -d '{
       "first_name": "–ò–≤–∞–Ω",
       "last_name": "–ü–µ—Ç—Ä–æ–≤",
       "email": "ivan@example.com",
       "password": "securepassword123"
     }'
```

### 2. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```
curl -X POST "http://127.0.0.1:8000/auth/login" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "ivan@example.com",
       "password": "securepassword123"
     }'
```
#### –û—Ç–≤–µ—Ç:
```
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

### 3. –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É
```
curl -X GET "http://127.0.0.1:8000/users/me" \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"
```
### 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
```
curl -X POST "http://127.0.0.1:8000/resource/products" \
     -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "name": "–ú–æ–π –ø—Ä–æ–¥—É–∫—Ç",
       "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"
     }'
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
#### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```
pytest tests/test_simple.py -v
```

#### –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:

‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

‚úÖ –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞

#### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é bcrypt

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

- –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ models/

- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ init_db.py

- –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –ø–æ –ø—Ä–∏–º–µ—Ä—É resource_router.py

- –î–æ–±–∞–≤—å—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ main.py
